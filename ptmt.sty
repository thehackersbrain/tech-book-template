\usepackage[2.0, compress]{bxpdfver} %% set PDF version to 2.0

% \usepackage[rmargin = 3.85cm, lmargin = 3.85cm, bmargin = 4cm, tmargin = 4cm]{geometry}
\usepackage[paperwidth=7in, paperheight=9.25in, margin=1in]{geometry}

\usepackage{amsfonts} %% additional math fonts
\usepackage{amsmath} %% math library
\usepackage{amssymb} %% collection of additional math symbols
\usepackage{amsthm} %% for theorem
\usepackage{fancyhdr} %% customization of headers and footers.
\usepackage[bottom, hang]{footmisc} %% provides more footnote options and symbols.
\usepackage{graphicx} %% for including images in the document.
\usepackage{mdframed} %% provides customizable framed boxes.
\usepackage{xcolor} %% allows defining and using colors in the document.

\usepackage[algoruled]{algorithm2e} %% algorithms and customizable algorithm environments.
\usepackage[english]{babel} %% for multilingual support.
\usepackage[cal = boondoxo]{mathalpha} %% customize the math alphabet
\usepackage{booktabs} %% enhances the quality of tables
\usepackage{csquotes} %% advanced quoting facilities.
\usepackage[onehalfspacing]{setspace} %% sets spacing between lines
\usepackage{listingsutf8} %% used in code block
\usepackage{float} %% improves the handling of floating elements such as figures and tables.
\usepackage{enumitem} %% customize the formatting of itemized and enumerated lists.
\usepackage[babel = true, final]{microtype} %% improves the typesetting quality by adjusting character spacing.
\usepackage{parskip} %% sets the space between paragraphs.
\usepackage{ragged2e} %% additional options for paragraph alignment.
\usepackage{emptypage}

\usepackage{fontspec} %% for loading custom fonts
\usepackage{lmodern} %% latin modern font
\usepackage{courierten} %% typewriter monospaced fonts
\usepackage{biolinum} %% font for sans-serif text to Biolinum

\defaultfontfeatures{Ligatures=TeX}
% \setmainfont[Scale=1.10]{Libertinus Serif} %% main body font
\newfontfamily\firamonofont[Scale=0.9, Contextuals=Alternate]{FiraMono Nerd Font} %% code block font
\newfontfamily\jbfont[Scale=MatchLowercase]{JetBrainsMono Nerd Font}
\newfontfamily\pfont{Poppins}

\setmainfont[
  Path = fonts/,
  UprightFont = *-Regular,
  BoldFont = *-Bold,
  ItalicFont = *-Italic,
  BoldItalicFont = *-BoldItalic
]{SourceSerif4}

\usepackage[bookmarks = true, citecolor = black, colorlinks = true, frenchlinks = true, linkcolor = black, pdfencoding = unicode, urlcolor = black]{hyperref}
\hypersetup{
    pdftitle = {Tech Book},
    pdfauthor = {Gaurav Raj},
    pdfsubject = {computer science},
    pdfkeywords = {computer science}
 } %% enables hyperlinks and provides options for PDF metadata and link colors.


% The enumitem package is used to
\setlist[itemize]{leftmargin=*, nosep, noitemsep}
\setlist[enumerate]{leftmargin=*, nosep, noitemsep, % label=(\arabic*)
}

% \renewcommand{\texttt}[1]{\textcolor{black!90}{\firamonofont #1}}
% \renewcommand{\texttt}[1]{\firamonofont #1}
% \renewcommand{\textbf}[1]{\jbfont #1}
\newcommand{\icode}[1]{\jbfont #1}
\newcommand{\ftn}[1]{\footnote{\textit{#1}}}

\setlength{\parindent}{2em} %% Paragraph Indentation


% Set up the code block style
\lstset{
    frame=lines, % Adds a frame around the code block
    showstringspaces=false, % Prevents marking spaces within strings
    tabsize=4, % Sets the tab size to 4 spaces
    title=\lstname, % Sets the title to the filename
    numbers=none, % Disables line numbering
    numberstyle=\smaller\color{black!90},
    caption={}, % Caption is empty by default, can be added if needed
    literate={\ }{{\ }}1{"}{\textquotedbl}1, % Handles space and quote formatting
    escapeinside={(@}{@)}, % Allows inserting LaTeX commands within code
    captionpos=b, % Places caption at the bottom of the code block
    % basicstyle=\ttfamily, % Uses typewriter font for code
    basicstyle=\firamonofont\small, % Uses typewriter font for code
    columns=fullflexible, % Makes column width flexible
    moredelim=[is][\bfseries]{***}{***}, % Bold text inside ***
    moredelim=[is][\itshape]{___}{___}, % Italic text inside ___
    moredelim=[is][\bfseries\itshape]{&&&}{&&&}, % Bold and italic inside &&&
    literate={_}{\_}1,
    aboveskip=20pt, % Adds vertical space above the code block
    breaklines=true, % Ensures long lines of code wrap correctly
    breakatwhitespace=true, % Ensures breaking at spaces
    xleftmargin=20pt, % Adds left margin for code block
    xrightmargin=20pt % Adds right margin for code block
}


\addtolength{\footskip}{12pt}
\pagestyle{fancy}
\renewcommand{\sectionmark}[1]{\markright{#1}}
\fancyhead{}
\fancyfoot{}
\fancyhead[LE, RO]{\smaller\leftmark}
\fancyfoot[LE]{{\normalsize\textbf{\thepage}}\ \ \ \smaller{\color{black!70}\rightmark}}
\fancyfoot[RO]{\smaller{\color{black!70}\rightmark}\ \ \ \ \normalsize\textbf{\thepage}}
% \fancyfoot[LO, RE]{\normalfont\rightmark}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\footrulewidth}{0.5pt}

% The \titleformat command is used to customize the format of a specific sectioning command.
% Here, we are customizing the format of chapter headings.

% \titleformat syntax:
% \titleformat{command}[shape]{format}{label}{sep}{before}[after]

% The command to be formatted is \chapter, which is a chapter heading.

% 'display' shape means the title will be displayed on a new line, occupying the whole text width.

% The format for the chapter heading is set to be bold and huge (\bfseries\huge).

% The label for the chapter heading consists of the chapter name (\chaptertitlename) and the chapter number (\thechapter).
% They will be right-aligned with a separation of 1ex from the chapter title.

% The before-code is used to draw a horizontal line (\titlerule) and add vertical space (1ex) above the chapter title.
% The chapter title will be left-aligned (\filleft) relative to this line.

% The after-code is used to add vertical space (1ex) and draw another horizontal line (\titlerule) after the chapter title.

\usepackage{titlesec}
\titleformat{\chapter}[display]
  {\bfseries\huge\pfont}
  {\filright \bf{\pfont\chaptertitlename} \pfont\Huge\thechapter}
  {1ex}
  {\titlerule\vspace{1ex}\filleft}
  % [\vspace{1ex}\titlerule]
  [\vspace{1ex}\titlerule]

% The xcolor package

% The secnumdepth counter controls the level of section numbering depth.
% Here, it is set to 5, which means all sectional units up to \subparagraph will be numbered.
\setcounter{secnumdepth}{5}

% The tocdepth counter controls the level of section entries displayed in the table of contents.
% Here, it is set to 5, which means all sectional units up to \subparagraph will be included in the table of contents.
\setcounter{tocdepth}{5}

\titleformat{\section}[block]{\normalfont\pfont\Large\bfseries}{}{0pt}{\hspace*{-1.5em}}
\titleformat{\subsection}[block]{\normalfont\pfont\large\bfseries}{}{0pt}{\hspace*{-1.2em}}
\titleformat{\subsubsection}[block]{\normalfont\pfont\normalsize\bfseries}{}{0pt}{\hspace*{-0.9em}}

% The following command defines a new command called \undersign.
% When you use \undersign in the document, it will produce a specific formatted text.
\newcommand{\undersign}{%
    \begin{flushright}
        \vfill
        First Author {\normalfont\textit{\&}} Second Author
        \rmfamily\normalfont
    \end{flushright}
}

% The following code defines several theorem-like environments with different styles.
% The 'plain' style is used for propositions, claims, conjectures, corollaries, definitions, facts, and lemmas.
% The 'definition' style is used for examples, exercises, problems, and solutions.
% The 'remark' style is used for remarks.
% Each environment is conditionally defined based on the existence of the '\thechapter' macro, which is defined when chapters are present.
% If '\thechapter' is undefined, the environments are not chapter-specific; otherwise, they are defined to be chapter-specific.

\makeatletter
% Proposition environment
\theoremstyle{plain}
\ifx\thechapter\undefined
  \newtheorem{prop}{\protect\propositionname}
\else
  \newtheorem{prop}{\protect\propositionname}[chapter]
\fi

% Claim environment
\theoremstyle{remark}
\ifx\thechapter\undefined
  \newtheorem{claim}{\protect\claimname}
\else
  \newtheorem{claim}{\protect\claimname}[chapter]
\fi

% Conjecture environment
\theoremstyle{plain}
\ifx\thechapter\undefined
  \newtheorem{conjecture}{\protect\conjecturename}
\else
  \newtheorem{conjecture}{\protect\conjecturename}[chapter]
\fi

% Corollary environment
\theoremstyle{plain}
\ifx\thechapter\undefined
  \newtheorem{cor}{\protect\corollaryname}
\else
  \newtheorem{cor}{\protect\corollaryname}[chapter]
\fi

% Definition environment
\theoremstyle{plain}
\ifx\thechapter\undefined
  \newtheorem{defn}{\protect\definitionname}
\else
  \newtheorem{defn}{\protect\definitionname}[chapter]
\fi

% Example environment
\theoremstyle{definition}
\ifx\thechapter\undefined
  \newtheorem{example}{\protect\examplename}
\else
  \newtheorem{example}{\protect\examplename}[chapter]
\fi

% Case environment specialized list
\newlist{casenv}{enumerate}{4}
\setlist[casenv]{leftmargin=*,align=left,widest={iiii}}
\setlist[casenv,1]{label={{\itshape\ \casename} \arabic*.},ref=\arabic*}
\setlist[casenv,2]{label={{\itshape\ \casename} \roman*.},ref=\roman*}
\setlist[casenv,3]{label={{\itshape\ \casename\ \alph*.}},ref=\alph*}
\setlist[casenv,4]{label={{\itshape\ \casename} \arabic*.},ref=\arabic*}

% Problem environment
\theoremstyle{definition}
\ifx\thechapter\undefined
  \newtheorem{problem}{\protect\problemname}
\else
  \newtheorem{problem}{\protect\problemname}[chapter]
\fi

% Remark environment
\theoremstyle{remark}
\ifx\thechapter\undefined
  \newtheorem{rem}{\protect\remarkname}
\else
  \newtheorem{rem}{\protect\remarkname}[chapter]
\fi

% Solution environment
\theoremstyle{definition}
\ifx\thechapter\undefined
  \newtheorem{sol}{\protect\solutionname}
\else
  \newtheorem{sol}{\protect\solutionname}[chapter]
\fi

% Theorem environment
\theoremstyle{plain}
\ifx\thechapter\undefined
  \newtheorem{thm}{\protect\theoremname}
\else
  \newtheorem{thm}{\protect\theoremname}[chapter]
\fi
\makeatother

% Custom names for theorem-like environments
\providecommand{\casename}{Case}
\providecommand{\claimname}{Claim}
\providecommand{\conjecturename}{Conjecture}
\providecommand{\corollaryname}{Corollary}
\providecommand{\definitionname}{Definition}
\providecommand{\examplename}{Example}
\providecommand{\exercisename}{Exercise}
\providecommand{\factname}{Fact}
\providecommand{\lemmaname}{Lemma}
\providecommand{\problemname}{Problem}
\providecommand{\propositionname}{Proposition}
\providecommand{\remarkname}{Remark}
\providecommand{\solutionname}{Solution}
\providecommand{\theoremname}{Theorem}


%% Environments
\newcommand{\sonote}[1]{\textsf{#1}}

\newenvironment{chapterdesc}
{\begingroup\large}
{\endgroup}

\newenvironment{aside}[1]{%
  \list{\makebox[0pt][r]{\jbfont \fontsize{7.5pt}{12pt}
    \colorbox{black}{\textcolor{white}{\sonote{#1}}}\hspace{2em}}}%
  {\listparindent=0pt
   \topsep=9pt
   \itemindent=0pt
   \rightmargin=0pt
   \leftmargin=0pt
   \labelwidth=0pt
   \labelsep=0pt}%
  \item\itshape
}{%
  \vspace{-3pt}
  \endlist
}

\newenvironment{note}{\begin{aside}{NOTE}}{\end{aside}}
\newenvironment{warning}{\begin{aside}{WARNING}}{\end{aside}}

\newcommand{\simplefigure}[2]{
  \begin{figure}[h!]
    \centering
    \includegraphics[width=0.8\textwidth]{#1}
    \caption{\textit{#2}}
  \end{figure}
}
